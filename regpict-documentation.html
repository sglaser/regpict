<!DOCTYPE html>
<html>

<head>
    <title>Regpict</title>
    <meta charset="utf-8">
    <!--    <script src="http://www.w3.org/Tools/respec/respec-w3c-common" async class="remove"></script>   -->
    <script src="respec-w3c-common.js" async class="remove"></script>
    <!--    <script src='require.js' data-main='regpict' async class="remove"></script>-->
    <!--<script src="regpict.js" async class="remove"></script>-->
    <script class="remove">
        var respecConfig = {
            additionalCopyrightHolders: "Copyright &copy; 2014 Nvidia, Inc.",
            specStatus:                 "unofficial",
            shortName:                  "regpict",
            editors:                    [
                {
                    name:       "Steve Glaser",
                    url:        "http://www.nvidia.com",
                    company:    "Nvidia, Inc",
                    companyURL: "http://nvidia.com"
                }
            ],
            onlyLocalBiblio:            true,
            cssOverride:                "unofficial.css",
            localBiblio:                {
                "RESPEC":      {
                    title:     "ReSpec -- The stark raving awesome way to write specs",
                    href:      "http://www.w3.org/respec/",
                    authors:   ["Robin Bergeron"],
                    publisher: "http://www.w3.org"
                },
                "RESPEC-Fork": {
                    title:   "Steve Glaser's fork of ReSpec",
                    href:    "http://github.com/sglaser/respec",
                    authors: ["Steve Glaser"]
                },
                "DOCBOOK":     {
                    title:     "The DocBook Document Type",
                    href:      "http://www.docbook.org/specs/docbook-4.5-spec.html",
                    authors:   ["Norman Walsh"],
                    publisher: "OASIS"
                },
                "EPUB3":       {
                    title:     "EPUB 3 Overview",
                    href:      "http://www.idpf.org/epub/30/spec/",
                    publisher: "IDPF"
                },
                "EPUB3SSV":    {
                    title:     "EPUB 3 Structural Semantics Vocabulary",
                    href:      "http://www.idpf.org/epub/vocab/structure/",
                    publisher: "IDPF"
                },
                "EPUBINDEX":   {
                    title:     "EPUB Indexes 1.0",
                    href:      "http://www.idpf.org/epub/idx/",
                    publisher: "IDPF"
                },
                "ASCIIDOCTOR": {
                    title: "Asciidoctor implementation of AsciiDoc",
                    href:  "http://asciidoctor.org"
                    //                    publisher: "asciidoctor.org"
                },
                "ASCIIDOC":    {
                    title: "AsciiDoc Text based document generation",
                    href:  "http://asciidoc.org"
                    //                    publisher: "asciidoc.org"
                },
                "PCISIG":      {
                    title:     "PCI Special Interest Group",
                    href:      "http://www.pcisig.com",
                    publisher: "http://www.pcisig.com"
                }
            }
        };
    </script>
    <style type="text/css">
        span[data-type=footnote] {
            background-color: #d3d3d3;
            border:           solid 1px black;
            border-radius:    0.25em;
            padding:          1px 3px;
            font-size:        smaller;
        }

        code {
            font-weight: 600;
        }

        ul > li {
            list-style: square;
        }

        ul > li > ul > li {
            list-style: circle;
        }

        ul > li > ul > li > ul > li {
            list-style: disc;
        }

        ul > li > ul > li > ul > li > ul > li {
            list-style: square;
        }

        ul > li > ul > li > ul > li > ul > li > ul > li {
            list-style: circle;
        }

        ul > li > ul > li > ul > li > ul > li > ul > li > ul > li {
            list-style: disc;
        }

        ol > li {
            list-style: decimal;
        }

        ol > li > ol > li {
            list-style: lower-alpha;
        }

        ol > li > ol > li > ol > li {
            list-style: lower-roman outside;
        }

        ol > li > ol > li > ol > li > ol > li {
            list-style: decimal;
        }

        ol > li > ol > li > ol > li > ol > li {
            list-style: decimal;
        }

        ol > li > ol > li > ol > li > ol > li > ol > li {
            list-style: lower-alpha;
        }

        ol > li > ol > li > ol > li > ol > li > ol > li > ol > li {
            list-style: lower-roman outside;
        }
    </style>
</head>

<body>
<section id="abstract">
    <p>
        The <dfn>Regpict</dfn> library draws register pictures in specifications. An example such figure is shown in
        <a href="#fig-json-register-example">Figure 1</a>.</p>
    <p>
        This library consists of two levels:
    </p>
    <ol>
        <li>A JSON to SVG conversion layer.
            <p>
                Converts a JSON formatted description of a hardware register into the corresponding SVG diagram.
            </p>
            <p>
                This layer supports inheritance.
            </p>
        </li>
        <li>A variety of JSON extraction layers.
            <p>
                These extract information from a variety of input formats and produce JSON usable by the JSON to SVG conversion layer. Input formats include:</p>
            <ul>
                <li>
                    <code>&lt;table class="regpict-pcisig"&gt;...&lt;/table&gt;</code> as used in recent [[PCISIG]] specifications.
                </li>
                <li><code>&lt;pre class="regpict-json"&gt;...&lt;/pre&gt;</code> containing the JSON code.</li>
                <li>
                    <code>&lt;pre class="regpict-refman"&gt;...&lt;/pre&gt;</code> containing Nvidia refman formatted text.
                </li>
            </ul>
        </li>
    </ol>
    <p>
        Using the JSON extraction layer is optional. The JSON to SVG conversion layer can be used standalone.
    </p>
    <p>
        The generated SVG is designed to be styled using CSS. Proper representation requires some CSS. A minimal CSS file is provided as well as a more complete example.
        <a href="#sect-svg-class-structure">Section 3</a> describes the classes contained in the generated SVG.
    </p>
    <p>
        The initial implementation is in JavaScript. This version was integrated into a fork [[RESPEC-Fork]] of the respec library [[RESPEC]].</p>
    <p>
        A version in Ruby that works as a plugin filter for [[ASCIIDOCTOR]] is anticipated.
    </p>

</section>
<section id="sotd">
</section>
<section class="introductory">
    <h2>Revision History and Notes</h2>
    <dl>
        <dt>8 July 2014</dt>
        <dd>First release of Working Draft</dd>
        <dt>23 August 2014</dt>
        <dd>Second release of Working Draft</dd>
    </dl>
</section>


<section id="sect-json-register-example">
    <h2>JSON Register Example</h2>
        <pre class="example" id="example-json-register-example" title="JSON Register Example">
        &lt;figure class="register"&gt;
            &lt;pre class="json"&gt; {
                "fields": {
                    "field 4:0": {
                        "msb":  4,
                        "lsb":  0,
                        "attr": "ro"
                    },
                    "bit9": {
                        "msb": 9,
                        "value": "1"
                    },
                    "bit10": {
                        "lsb":   10,
                        "value": "0"
                    },
                    "bit11": {
                        "lsb": 11
                    },
                    "bit 12:15": {
                        "lsb":   12,
                        "msb":   15,
                        "value": "value"
                    },
                    "byte": {
                        "lsb":   16,
                        "msb":   31,
                        "value": [ "A", "B", "C", "D", "E", "F", "G", "H"]
                    }
                }
            }
            &lt;/pre&gt;
            &lt;figcaption&gt;JSON Register Example&lt;/figcaption&gt;
        &lt;/figure&gt;
    </pre>

    <figure class="register" id="fig-json-register-example">

        <!-- for figures.register.pcisig_reg, the data-table attribute is the ID of the PCISIG style table describing the fields -->

        <!-- any nested div.json, pre.json, or span.json within figure.register is parsed for json content -->
        <!-- the width argument describes the register width (defaults to 32 bits) -->
        <!-- the unused item is name used for bit fields that are not otherwise defined (defaults "RsvdP" -->
        <!-- var width               = Number(pget(reg, "width", 32));-->
        <!-- var unused              = String(pget(reg, "unused", "RsvdP"));-->
        <!-- var defaultAttr         = String(pget(reg, "defaultAttr", "other"));-->
        <!-- var cellWidth           = Number(pget(reg, "cellWidth", 16));-->
        <!-- var cellHeight          = Number(pget(reg, "cellHeight", 32));-->
        <!-- var cellInternalHeight  = Number(pget(reg, "cellInternalHeight", 8));-->
        <!-- var bracketHeight       = Number(pget(reg, "bracketHeight", 4));-->
        <!-- var cellTop             = Number(pget(reg, "cellTop", 16));-->
        <!-- var figName             = String(pget(reg, "name", "???"));-->
        <!-- var fields              = pget(reg, "fields", [ ]); // default to empty register-->

        <!-- Fields are in arbitrary order. Items in in a field are: -->
        <!--  name      Name of the field -->
        <!--  msb       bit number of the most significant bit (or only bit) -->
        <!--  lsb       bit number of the least significant bit (or only bit) -->
        <!--  unused    true if field is considered "unused" -->
        <!--  attr      field type (e.g. other, rw, ro, rw1c, ros, ...) -->
            <pre class="json">            
            {
                "fields": {
                    "field 4:0": {
                        "msb":  4,
                        "lsb":  0,
                        "attr": "ro"
                    },
                    "bit9": {
                        "msb": 9,
                        "value": "1"
                    },
                    "bit10": {
                        "lsb":   10,
                        "value": "0"
                    },
                    "bit11": {
                        "lsb": 11
                    },
                    "bit 12:15": {
                        "lsb":   12,
                        "msb":   15,
                        "value": "value"
                    },
                    "byte": {
                        "lsb":   24,
                        "msb":   31,
                        "value": [ "A", "B", "C", "D", "E", "F", "G", "H"]
                    }
                }
            }
            </pre>
        <figcaption>JSON Register Example</figcaption>
    </figure>
</section>
<section id="sect-json-format-details">
    <h2>JSON Format Details</h2>
    <p>
        The JSON intermediate format contains a collection of properties related to the overall register as well as a
        <a>fields</a> property with details for each register field. The each property of
        <a>fields</a> describes the corresponding register field.</p>

    <section id="sect-register-properties">
        <h2>Register Properties</h2>
        <p>The following register properties are defined:</p>
        <dl>

            <dt><dfn>width</dfn></dt>
            <dd>
                Width of the register, in bits. Default is 32.
            </dd>

            <dt><dfn>defaultUnused</dfn></dt>
            <dd>
                Name to apply to unused bits in the register. Default is "RsvdP".
            </dd>

            <dt><dfn>defaultAttr</dfn></dt>
            <dd>
                Attribute to apply to fields that do not specify one. Default is "other".
            </dd>

            <dt><dfn>cellWidth</dfn></dt>
            <dd>
                Width of a bit cell, in pixels. Default is 16px.
            </dd>

            <dt><dfn>cellHeight</dfn></dt>
            <dd>
                Height of a bit cell, in pixels. Default is 32px.
            </dd>

            <dt><dfn>cellInternalHeight</dfn></dt>
            <dd>
                Height of the bit separator lines with a multi-bit cell. Default is 8px.
            </dd>

            <dt><dfn>cellTop</dfn></dt>
            <dd>
                Location of top of every bit cell, in pixels. Default is 40px.
            </dd>

            <dt><dfn>figLeft</dfn></dt>
            <dd>
                Location of the left edge of the register, in pixels. Default is 32px.
            </dd>

            <dt><dfn>cellValueTop</dfn></dt>
            <dd>
                Top of the text for a multi-bit field value relative to <a>cellTop</a>.
                This applies to bit fields that are wider than one bit and that have a
                <a>value</a> property that does not specify individual bit values.
                Default is 16px.
            </dd>

            <dt><dfn>cellBitValueTop</dfn></dt>
            <dd>
                Top of the text for a single bit value relative to <a>cellTop</a>.
                This applies to all bit fields that are one bit wide.
                This also applies to wider fields that contain a <a>value</a> that contains individual bit values.
                Default is 20px.
            </dd>

            <dt><dfn>cellBitNameTop</dfn></dt>
            <dd>
                Top of the text for a bit name that's displayed inside the register field.
                This applies to bit fields that bit fields where the text fits in the bit cell(s) that do not have a
                <a>value</a> specified.
                Default is 16px.
            </dd>

            <dt><dfn>bracketHeight</dfn></dt>
            <dd>
                Height of the bracket drawn below the bit field when the field name is displayed outside the register field. Default is 4px.
            </dd>

            <dt><dfn>figName</dfn></dt>
            <dd>
                Prefix to use when generating <a>id</a> values for fields in the generated SVG. Default is "???".
            </dd>

            <dt><dfn>maxFieldWidth</dfn></dt>
            <dd>
                Maximum width of the figure.
                Default is 720px (approximately 7.5 inches).
            </dd>

            <dt><dfn>visibleLSB</dfn></dt>
            <dd>
                Least Significant bit that will be displayed.
                Default is 0.
            </dd>

            <dt><dfn>visibleMSB</dfn></dt>
            <dd>
                Most Significant Bit that will be displayed.
                Fields that start above this value will not be displayed.
                Fields that start below this value and end above this value will be partially displayed.
                Default is <a>width</a> (i.e. one greater than the register width).
            </dd>

            <dt><dfn>table</dfn></dt>
            <dd>Contains the locator for a PCISIG formatted table to parse.
                Includes the leading &lsquo;#&rdquo; character (e.g. &ldquo;#tbl-pcisig-style-table&ldquo;).
                See <a href="#sect-figure-data-table-attribute"></a> and
                <a href="#sect-pcisig-style-table"></a>.
            </dd>

            <dt><dfn>href</dfn></dt>
            <dd>
                Contains the locator for an Nvidia formatted refman file to parse.
                See <a href="#sect-figure-data-href-attribute"></a> and
                <a href="#sect-nvidia-refman"></a>.
            </dd>

            <dt><dfn>register</dfn></dt>
            <dd>
                Contains the locator for an external &lt;pre&gt;, &lt;div&gt; or &lt;span&gt; element containing JSON to parse.
                See <a href="#sect-figure-data-register-attribute"></a> and
                <a href="#sect-json-outside-the-figure"></a>.
            </dd>

            <dt><dfn>fields</dfn></dt>
            <dd>
                JSON Object containing one property per register field. Default is the empty property <code>{ }</code>.
            </dd>

        </dl>
    </section>
    <section id="sect-field-properties">
        <h2>Field Properties</h2>
        <p>The following properties are defined for register fields:</p>
        <dl>
            <dt><dfn>name</dfn></dt>
            <dd>
                <p>
                    Name of the field. If the name fits in the field box and no
                    <a>value</a> is provided for the field, the name is drawn in the field box, centered horizontally, with the top edge of the name text at cellNameTop. Otherwise, the field name is drawn to the right of bit
                    <a>visibleLSB</a> with a line connecting the field name to the middle of the bit field.
                </p>
                <p>
                    If <a>name</a> is not specified, the default is the property name of the field within the
                    <a>fields</a> property of the register. Note: all fields in
                    <a href="#fig-json-register-example">Figure 1</a> do not have a <a>name</a> property.
                </p>
            </dd>

            <dt><dfn>id</dfn></dt>
            <dd>
                This property contains a string value that specified the <code>id</code> attribute for the
                <code>&lt;g&gt;</code> element in the generated SVG.
                If this property is not explicitly defined and field is not <a>isUnused</a>, an
                <code>id</code> attribute will be be created for the field using rules defined in
                <a href="#sect-svg-id-attribute">Section 3.4</a>.
            </dd>

            <dt><dfn>lsb</dfn></dt>
            <dd>
                Least Significant Bit number. If omitted, field is 1 bit wide containing just the
                <a>msb</a>. At least one of <a>lsb</a> or <a>msb</a> must be specified.
            </dd>

            <dt><dfn>msb</dfn></dt>
            <dd>
                Most Significant Bit number. If omitted, field is 1 bit wide containing just the
                <a>lsb</a>. At least one of <a>lsb</a> or <a>msb</a> must be specified.
            </dd>

            <dt><dfn>value</dfn></dt>
            <dd>
                The value for the field. This property takes on the following forms:
                <ul>
                    <li>
                        Single string value, and the field with is greater than 1 bit. The
                        <a>value</a> property is displayed in the field box, centered horizontally, with its top edge at
                        <a>cellValueTop</a>.
                    </li>
                    <li>
                        Single string value, and the field width is exactly 1 bit. The
                        <a>value</a> property is displayed in the field box, centered horizontally, with its top edge at
                        <a>cellBitValueTop</a>.
                    </li>
                    <li>
                        JSON array value where the array length equals the field width in bits and the array values are all strings. The string values are typically 1 character due to space limitations. You can make more room by increasing
                        <a>cellWidth</a> or decreasing the font size for the class
                        <a>regBitFieldValue</a>. Each array item is drawn centered horizontally in the corresponding bit cell, with its top edge at
                        <a>cellBitValueTop</a>.
                    </li>
                </ul>
            </dd>

            <dt><dfn>attr</dfn></dt>
            <dd>
                This property is a string that indicates the type of this field. If this property contains
                <i>x</i>, the generated SVG has class
                <a>regAttr_xxx</a>. This permits styling of register fields based on field attribute (Read Only, Read Write, etc.). This value is converted to lower case so it's irrelevant what case is used for this property. This property must be a valid class name (e.g. no spaces, etc.). Common values are: rw, rws, ro, ros, rw1c, rw1cs, rw1s, rw1ss, wo, wos, hardwired, fixed, hwinit, rsvd, rsvdp, rsvdz, reserved, unused, and other. The default value of
                <a>attr</a> is "other".
            </dd>

            <dt><dfn>isUnused</dfn></dt>
            <dd>
                Unused field indicator. If
                <a>isUnused</a> is present and has the value true, this bits that comprise this field are some flavor of undefined (e.g. Reserved, RsvdP, RsvdZ). The the drawn field has the class
                <a>regFieldUnused</a> to permit styling using CSS. Unused field indicator. If
                <a>isUnused</a> is present and has the value true, this bits that comprise this field are some flavor of undefined (e.g. Reserved, RsvdP, RsvdZ). The the drawn field has the class
                <a>regFieldUnused</a> to permit styling using CSS.
            </dd>

            <dt><dfn>addClass</dfn></dt>
            <dd>
                If
                <a>addClass</a> is present, it MUST contain a string value. This value contains one or more class names. Each of these class names is appended to the list of classes for the generated
                <code>&lt;g&gt;</code> element. A good application for the
                <a>addClass</a> property is to highlight particular fields, when this highlighting is not an intrinsic property of the field. For example, if the same figure is used in multiple places, with each usage explaining some of the fields, the
                <a>addClass</a> property can be used to highlight the appropriate fields. Intrinsic properties of a field are better indicated through the
                <a>attr</a> property.
            </dd>
        </dl>
    </section>
</section>
<section id="sect-svg-class-structure">
    <h2>SVG Class Structure</h2>
    <p>
        This section describes the structure of the generated SVG. Knowing this structure permits more flexible styling of the resulting diagram using CSS.
    </p>
    <p>
        The generated SVG contains a
        <code>&lt;g&gt;</code> element for every field. This includes fields that are explicitly defined as well as fields that are created to represent unused register bits.
    </p>

    <section id="sect-external-field">
        <h2><dfn>External Field</dfn></h2>
        <p><a>Regpict</a> will generate an
            <a>External Field</a> when the field <a>name</a> doesn't fit in the bit field box or the field has a
            <a>value</a> property.
        </p>
        <p>An example <a>External Field</a> is shown below. This is the <a class="regpict">bit 12:15</a> field from
            <a href="#fig-json-register-example">Figure 1</a>.</p>
            <pre class="example">
&lt;g id="regpict-json-register-example-bit-12-15"
   class="regFieldExternal regAttr_other regLink regFieldExternal1"&gt;
    &lt;text x="358" y="36" class="regBitNumEnd"&gt;12&lt;/text&gt;
    &lt;text x="298" y="36" class="regBitNumStart"&gt;15&lt;/text&gt;
    &lt;line x1="360" y1="40" x2="360" y2="26.5" class="regBitNumLine_Hide"&gt;&lt;/line&gt;
    &lt;line x1="296" y1="40" x2="296" y2="26.5" class="regBitNumLine"&gt;&lt;/line&gt;
    &lt;rect x="296" y="40" width="64" height="32" class="regFieldBox"&gt;&lt;/rect&gt;
    &lt;line x1="344" y1="64" x2="344" y2="72" class="regFieldBox"&gt;&lt;/line&gt;
    &lt;line x1="328" y1="64" x2="328" y2="72" class="regFieldBox"&gt;&lt;/line&gt;
    &lt;line x1="312" y1="64" x2="312" y2="72" class="regFieldBox"&gt;&lt;/line&gt;
    &lt;text x="328" y="20" class="regBitWidth"&gt;4 bits&lt;/text&gt;
    &lt;text x="568" y="152" class="regFieldName"&gt;bit 12:15&lt;/text&gt;
    &lt;text x="328" y="56" class="regFieldValue"&gt;value&lt;/text&gt;
    &lt;path d="M296,72l32,4L360,72" class="regBitBracket" fill="none"&gt;&lt;/path&gt;
    &lt;path d="M328,76V147.5H566.4" class="regBitLine" fill="none"&gt;&lt;/path&gt;
&lt;/g&gt;
            </pre>
    </section>
    <section id="sect-internal-field">
        <h2><dfn>Internal Field</dfn></h2>
        <p>
            <a>Regpict</a> will generate an Internal Field when the field name fits in the bit field box and there is no value property.
        </p>
        <p>An example Internal Field is shown below. This is the <a class="regpict">field 4:0</a> field from
            <a href="#fig-json-register-example">Figure 1</a>.</p>
            <pre class="example">
&lt;g id="regpict-json-register-example-field-4-0"
   class="regFieldInternal regAttr_ro regLink"&gt;
    &lt;text x="550" y="36" class="regBitNumEnd"&gt;0&lt;/text&gt;
    &lt;text x="474" y="36" class="regBitNumStart"&gt;4&lt;/text&gt;
    &lt;line x1="552" y1="40" x2="552" y2="26.5" class="regBitNumLine"&gt;&lt;/line&gt;
    &lt;line x1="472" y1="40" x2="472" y2="26.5" class="regBitNumLine"&gt;&lt;/line&gt;
    &lt;rect x="472" y="40" width="80" height="32" class="regFieldBox"&gt;&lt;/rect&gt;
    &lt;line x1="536" y1="64" x2="536" y2="72" class="regFieldBox"&gt;&lt;/line&gt;
    &lt;line x1="520" y1="64" x2="520" y2="72" class="regFieldBox"&gt;&lt;/line&gt;
    &lt;line x1="504" y1="64" x2="504" y2="72" class="regFieldBox"&gt;&lt;/line&gt;
    &lt;line x1="488" y1="64" x2="488" y2="72" class="regFieldBox"&gt;&lt;/line&gt;
    &lt;text x="512" y="20" class="regBitWidth"&gt;5 bits&lt;/text&gt;
    &lt;text x="512" y="56" class="regFieldName"&gt;field 4:0&lt;/text&gt;
&lt;/g&gt;
        </pre>
    </section>
    <section id="sect-generated-g-element-class-attributes">
        <h2>Generated <code>&lt;g&gt;</code> element: <code>class</code> attributes</h2>
        <p>The generated SVG has a variety of classes available. This allows customizing the styling of the diagram using CSS.</p>
        <p>The following classes are defined:</p>
        <dl>
            <dt>g .<dfn>regFieldInternal</dfn></dt>
            <dd>
                Applied to the <code>&lt;g&gt;</code> element to indicate an Internal Field.
            </dd>

            <dt>g .<dfn>regFieldExternal</dfn></dt>
            <dd>
                Applied to the <code>&lt;g&gt;</code> element to indicate and <a>External Field</a>.
            </dd>

            <dt>g .<dfn>regFieldExternal0</dfn></dt>
            <dt>g .<dfn>regFieldExternal1</dfn></dt>
            <dd>
                Applied to the <code>&lt;g&gt;</code> element of an <a>External Field</a>. The two least significant
                <a title="External Field">External Fields</a> have <a>regFieldExternal0</a>. The next two
                <a title="External Field">External Fields</a> have
                <a>regFieldExternal1</a>. The pattern repeats with next two
                <a title="External Field">External Fields</a> have <a>regFieldExternal0</a>, followed by two with
                <a>regFieldExternal1</a>. These classes can be used to format the lines differently to enhance readability.
            </dd>

            <dt>g .<dfn>regLink</dfn></dt>
            <dd>
                Applied to the
                <code>&lt;g&gt;</code> element to indicate a defined field that can be referenced externally. These fields have an
                <code>id</code> attribute).
            </dd>

            <dt>g .<dfn>regFieldOverflowLSB</dfn></dt>
            <dd>
                Applied to the
                <code>&lt;g&gt;</code> element to indicate that the field is partially visible because its
                <a>lsb</a> is less than <a>visibleLSB</a>.
            </dd>

            <dt>g .<dfn>regFieldOverflowMSB</dfn></dt>
            <dd>
                Applied to the
                <code>&lt;g&gt;</code> element to indicate that the field is partially visible because its
                <a>msb</a> is greater than <a>visibleMSB</a>.
            </dd>

            <dt>g .<dfn>regFieldHidden</dfn></dt>
            <dd>
                Applied to the
                <code>&lt;g&gt;</code> element to indicate that the field is not visible either because its
                <a>lsb</a> is greater than <a>visibleMSB</a> or its <a>msb</a> is less than <a>visibleLSB</a>.
            </dd>

            <dt>g .<dfn>regAttr_<code>xxx</code></dfn></dt>
            <dd>
                Applied to the <code>&lt;g&gt;</code> element to convey the attributes of the corresponding field.
                The <code>xxx</code> is the <a>attr</a> value converted to lower case.
            </dd>

            <dt>g .<dfn>regFieldUnused</dfn></dt>
            <dd>
                Applied to the <code>&lt;g&gt;</code> element of an Internal Field to indicate that the
                <a>isUnused</a> property was present and <code>true</code>. Not applicable to an <a>External Field</a>.
            </dd>

            <dt>text .<dfn>regBitNumStart</dfn></dt>
            <dd>
                Applied to the <code>&lt;text&gt;</code> element that contains the msb bit number of the field.
                Used only for multi-bit fields.
            </dd>

            <dt>text .<dfn>regBitNumEnd</dfn></dt>
            <dd>
                Applied to the <code>&lt;text&gt;</code> element that contains the lsb bit number of the field.
                Used only for multi-bit fields.
            </dd>

            <dt>text .<dfn>regBitNumMiddle</dfn></dt>
            <dd>
                Applied to the <code>&lt;text&gt;</code> element that contains the bit number of the field.
                Used only for single bit fields.
            </dd>

            <dt>line .<dfn>regBitNumLine</dfn></dt>
            <dd>
                Applied to the
                <code>&lt;line&gt;</code> element that represents the line adjacent to the lsb and msb bit numbers of the field.
            </dd>

            <dt>line .<dfn>regBitNumLine_Hide</dfn></dt>
            <dd>
                Same as <a>regBitNumLine</a>.
                Applied to the line adjacent to the lsb bit number of all fields except for the least significant visible field (i.e.
                <a>lsb</a> == <a>visibleLSB</a>).
                This element should be hidden by default and should become visible when the user hovers over the
                <code>&lt;g&gt;</code> element.
            </dd>

            <dt>rect .<dfn>regFieldBox</dfn></dt>
            <dd>
                Applied to the <code>&lt;rect&gt;</code> element that represents the bit field box.
            </dd>

            <dt>line .<i>regFieldBox</i></dt>
            <dd>
                Applied to the
                <code>&lt;line&gt;</code> element that represents the bit divider lines within the bit field box.
                Used only for multi-bit fields.
            </dd>

            <dt>text .<dfn>regFieldName</dfn></dt>
            <dd>
                Applied to the <code>&lt;text&gt;</code> element that contains the field name.
            </dd>

            <dt>text .<dfn>regBitWidth</dfn></dt>
            <dd>
                Applied to the <code>&lt;text&gt;</code> element that contains the width of the field.
                This element should be hidden by default and should become visible when the user hovers over the
                <code>&lt;g&gt;</code> element.
            </dd>

            <dt>text .<dfn>regFieldValue</dfn></dt>
            <dd>
                Applied to the <code>&lt;text&gt;</code> element that contains the field value.
                Used for all fields that contain a <a>value</a> property.
            </dd>

            <dt>text .<dfn>regBitFieldValue</dfn></dt>
            <dd>
                Applied to the <code>&lt;text&gt;</code> element that contains a single bit of the field <a>value</a>.
                Used for fields that contain individual bit field values.
                These fields also have class <a>regFieldValue</a>.
            </dd>

            <dt>text .<dfn>regBitFieldValue-<code>N</code></dfn></dt>
            <dd>
                Applied to the <code>&lt;text&gt;</code> element that contains bit
                <code>N</code> of the field <a>value</a>.
                Permits formatting individual bit values differently.
            </dd>

            <dt>text .<dfn>regBitFieldValue-msb</dfn></dt>
            <dd>
                Applied to the
                <code>&lt;text&gt;</code> element that contains the value of the most significant bit of the field
                <a>value</a>.
                Permits formatting the msb value differently.
                The lsb equivalent is <a title="regBitFieldValue-N">regBitFieldValue-0</a>.
            </dd>

            <dt>path .<dfn>regBitBracket</dfn></dt>
            <dd>
                Applied to the <code>&lt;path&gt;</code> element of an
                <a>External Field</a> that is the bracket immediately below the bit field box. Not applicable to Internal Fields.
            </dd>


            <dt>path .<dfn>regBitLine</dfn></dt>
            <dd>
                Applied to the <code>&lt;path&gt;</code> element of an
                <a>External Field</a> that connects the bracket to the field name. Not applicable to Internal Fields.
            </dd>

            <dt>text .<dfn>svg_error</dfn></dt>
            <dd>
                Applied to invalid <a>value</a> properties.
            </dd>

        </dl>

    </section>
    <section id="sect-svg-id-attribute">
        <h2>Generated <code>&lt;g&gt;</code> element: <code>id</code> attribute</h2>
        <p>
            <a>Regpict</a> will generate a unique <code>id</code> attribute for most fields.
            No <code>id</code> is generated for <i>unused</i> fields (i.e. fields that have an
            <a>isUnused</a> property with the value <code>true</code>.
            All other fields have an <code>id</code> attribute generated as follows:
        </p>
        <ol>
            <li>Construct a preliminary id string from:
                <ol>
                    <li>
                        The <a>id</a> property of the field, if present.
                    </li>
                    <li>
                        The <a>figName</a> property of the register,
                        <br>followed by a dash (&ldquo;-&rdquo;),
                        <br>followed by the <a>name</a> property of the field.
                    </li>
                </ol>
            </li>
            <li>Sanitize the preliminary id string by:
                <ol>
                    <li>Converting upper case to lower case.</li>
                    <li>Removing leading and trailing spaces.</li>
                    <li>
                        Replacing sequences of one or more invalid characters with &ldquo;-&rdquo;.
                        <br>
                        For this purpose, characters that are not digits, letters, periods, dashs, or underscores are invalid.
                    </li>
                    <li>Removing leading and trailing sequences of dashes.</li>
                    <li>If the last character is a period, append the letter &ldquo;x&rdquo;.</li>
                    <li>If the first character is not a letter, prepend the letter &ldquo;x&rdquo;.</li>
                    <li>If the value is the empty string at this point, use the string &ldquo;generatedID&rdquo;.</li>
                </ol>
            </li>
            <li>Prepend &ldquo;regpict-&rdquo; to the prelminary id.</li>
            <li>Check to see if the preliminary id is unique or if duplicates a
                <code>id</code> attribute already present the document.
            </li>
            <li>
                If the preliminary id is already present in the document, create a unique version of it by appending &rdquo;<code>-N</code>&ldquo; where &rdquo;<code>N</code>&ldquo; a is the smallest integer value greater 0 that is not already used in the document.
                For example, for the preliminary id &ldquo;regpict-foo&rdquo; is already present, the next one is &ldquo;regpict-foo-1&rdquo;, followed by &ldquo;regpict-foo-2&rdquo;, and so forth.
            </li>
        </ol>
        </li>
        </ol>
    </section>
    <section id="sect-unused-bits">
        <h2>Unused Bits</h2>
        <p>Unused bits in a register cause a field to be invented by <a>Regpict</a>.</p>
        <p>This field has the following properties:</p>
        <ul>
            <li>
                <a>name</a>: the value of the <a>defaultUnused</a> property of the register.
                <br>If it doesn't fit, only the first character is
                <a>defaultUnused</a> is used, converted to upper case.
            </li>
            <li><a>attr</a>: the value of the <a>defaultUnused</a> property of the register, converted to lower case
            </li>
            <li><a>isUnused</a>: <code>true</code></li>
            <li><a>lsb</a>: least significant bit of a string of one or more unused bits</li>
            <li><a>msb</a>: most significant bit in a string of one or more unused bits</li>
            <li><a>value</a>: not present</li>
            <li><a>id</a>: not present</li>
            <li><a>addClass</a>: not present</li>
        </ul>
    </section>
</section>
<section id="sect-respec-usage">
    <h2>Respec Usage</h2>
    <p>This section describes usage of the regpict feature in Steve Glaser's fork of respec [[RESPEC-Fork]].</p>
    <p>
        There are 4 ways to use regpict:
    </p>
    <ul>
        <li>JSON directly in &lt;figure&gt;. <a href="#sect-json-directly-in-figure"></a></li>
        <li>JSON outside the &lt;figure&gt;. <a href="#sect-json-outside-the-figure"></a></li>
        <li>PCISIG style HTML &lt;table&gt;. <a href="#sect-pcisig-style-table"></a></li>
        <li>Register extracted from external file in Nvidia refman format. <a href="#sect-nvidia-refman"></a></li>
    </ul>
    Each usage is described in the following sections.
    <section id="sect-common-rules-for-all-figure-class-register-elements">
        <h2>Common Rules for all &lt;figure class="register"&gt; elements</h2>

        <section id="sect-figure-figname-property">
            <h2>Figure <a>figName</a> property</h2>
            The <a>figName</a> property of the register is computed as follows:
            <ol>
                <li>The
                    <code>id</code> attribute of the &lt;figure&gt; element, removing the text &ldquo;fig-&rdquo; from the beginning of the value.
                </li>
                <li>Otherwise, the <code>title</code> attribute of the &lt;figure&gt;.</li>
                <li>Otherwise, the text contents of the
                &lt;figcaption&gt; element inside the
                    &lt;figure&gt;.</li>
                <li>Otherwise, the string &ldquo;unnamed-<i>regno</i>&rdquo; where
                    <i>regno</i> is a number, starting at 1 and incrementing by 1 every time a string of this form is created.
                </li>
            </ol>
            <p>This value is then sanitized by:</p>
            <ol>
                <li>Removing leading and trailing white space characters.</li>
                <li>
                    Replacing strings of one or more illegal characters with a single &ldquo;-&rdquo;.
                    For this purpose, illegal characters are anything except digits, letters, dash, underscore, and period.
                </li>
                <li>Removing all leading and trailing dashes.</li>
                <li>Appending &ldquo;x&rdquo; if the last character is not a letter.</li>
                <li>Prepending &ldquo;x&rdquo; if the first character is not a letter.</li>
                <li>Replacing the empty string with &ldquo;generatedID&rdquo;.</li>
            </ol>
        </section>
        <section id="sect-figure-id-attribute">
            <h2>Figure <code>id</code> attribute</h2>
            <p>If the &lt;figure&gt; does not have an
                <code>id</code> attribute, it is set to &ldquo;fig-<i>figName</i>&rdquo; where <i>figName</i> is the
                <a>figName</a> property defined in <a href="#sect-figure-figname-property"></a>.</p>
        </section>
        <section id="sect-figure-data-json-attribute">
            <h2>Figure <code>data-json</code> attribute</h2>
            If the &lt;figure&gt; has a
            <code>data-json</code> attribute, it's value is parsed and merged into the figure's JSON.
        </section>
        <section id="sect-figure-data-width-attribute">
            <h2>Figure <code>data-width</code> attribute</h2>
            If the &lt;figure&gt; has a <code>data-width</code> attribute, it's value becomes the
            <a>width</a> property of the figure's JSON.
        </section>
        <section id="sect-figure-data-unused-attribute">
            <h2>Figure <code>data-unused</code> attribute</h2>
            If the &lt;figure&gt; has a <code>data-unused</code> attribute, it's value becomes the
            <a>defaultUnused</a> property of the figure's JSON.
        </section>
        <section id="sect-figure-data-href-attribute">
            <h2>Figure <code>data-href</code> attribute</h2>
            If the &lt;figure&gt; has a <code>data-href</code> attribute, it's value becomes the
            <a>href</a> property of the figure's JSON.
        </section>
        <section id="sect-figure-data-table-attribute">
            <h2>Figure <code>data-table</code> attribute</h2>
            If the &lt;figure&gt; has a <code>data-table</code> attribute, it's value becomes the
            <a>table</a> property of the figure's JSON.
        </section>
        <section id="sect-figure-data-register-attribute">
            <h2>Figure <code>data-register</code> attribute</h2>
            If the &lt;figure&gt; has a <code>data-register</code> attribute, it's value becomes the
            <a>register</a> property of the figure's JSON.
        </section>

    </section>
    <section id="sect-json-directly-in-figure">
        <h2>JSON directly in &lt;figure&gt;</h2>
        <p>If the &lt;figure&gt; contains one or more &lt;pre class="json"&gt;, &lt;div class="json"&gt;, or &lt;span class="json"&gt; elements, these elements are parsed and combined and the resulting figure is drawn. These elements are hidden as they are parsed (class &ldquo;hide&rdquo; added so they can be hidden by css).</p>
        <p>If the JSON does not define a <a>figName</a> property, the &lt;figcaption&gt; value is used to invent one.
        </p>
        <p>This situation is shown in <a href="#fig-json-directly-in-figure">Figure 2</a> and <a
                href="#example-json-directly in figure">Example 4</a></p>

        <figure class="register" id="fig-json-directly-in-figure">
            <pre class="json">
{
    "fields": {
        "foo": {
            "lsb": 0,
            "msb": 7
        }
    }
}
            </pre>
            <figcaption>JSON directly in &lt;figure&gt;</figcaption>
        </figure>

        <pre class="example" id="example-json-directly-in-figure" title="JSON directly in &lt;figure&gt;">
            &lt;figure class="register" id="fig-json-directly-in-figure"&gt;
                &lt;pre class="json"&gt;
                    {
                        "fields": {
                            "foo": {
                                "lsb": 0,
                                "msb": 7
                            }
                        }
                    }
                &lt;/pre>
                &lt;figcaption&gt;JSON directly in &amp;lt;figure&amp;gt;&lt;/figcaption&gt;
            &lt;/figure&gt;
        </pre>

    </section>

    <section id="sect-json-outside-the-figure">
        <h2>JSON outside the &lt;figure&gt;</h2>
        <p>
            If the &lt;figure&gt; contains one or more &lt;pre class="render"&gt;, &lt;div class="render"&gt;, or &lt;span class="render"&gt; elements, these elements are parsed a figure is drawn for each such element.
            This can result in a single &lt;figure&gt; element having multiple figure diagrams.
            This is particularly useful in conjunction with <a>visibleLSB</a> and <a>visibleMSB</a> to display very wide registers conveniently.
            These elements are hidden as they are parsed (class &ldquo;hide&rdquo; added so they can be hidden by css).</p>
        <p>If the &lt;pre&gt;, &lt;div&gt;, or &lt;span&gt; element has the <code>data-parents</code> attribute, this contains a list of one or more locators for external field definitions. The parents are merged into a copy of the &lt;figure&gt; JSON, in the order shown and then the JSON in the element is merged in. The figure is drawn with the resulting JSON. The JSON associated with the &lt;figure&gt; element is not affected.
        <p>If the JSON does not define a <a>figName</a> property, the &lt;figcaption&gt; value is used to invent one.
        </p>
        <p>This situation is shown in <a href="#fig-json-outside-the-figure">Figure 3</a> and <a
                href="#example-json-outside-the-figure">Example 4</a></p>

        <pre id="pre-external-json" class="json">
{
    "width": 64,
     "fields": {
        "lowByte": {
            "lsb": 0,
            "msb": 7
        },
        "highByte": {
            "lsb": 56,
            "msb": 63
        },
        "middle": {
            "lsb": 28,
            "msb": 39
        }
    }
}
        </pre>
        <figure class="register">
            <pre class="render" data-parents="pre-external-json">{ }</pre>
            <pre class="render" data-parents="pre-external-json">
                { "visibleLSB": 31 }</pre>
            <pre class="render" data-parents="pre-external-json">
                { "visibleMSB": 32 }</pre>
            <figcaption>JSON outside the &lt;figure&gt;</figcaption>
        </figure>

        <pre class="example" id="example-json-outside-the-figure">

        &lt;pre id="pre-external-json" class="json"&gt;
        {
            "width": 64,
            "fields": {
                "lowByte": {
                    "lsb": 0,
                    "msb": 7
                },
                "highByte": {
                    "lsb": 56,
                    "msb": 63
                },
                "middle": {
                    "lsb": 28,
                    "msb": 39
                }
            }
        }
        &lt;/pre&gt;

        &lt;figure class="register"&gt;

            &lt;pre class="render" data-parents="pre-external-json"&gt;{ }&lt;/pre&gt;

            &lt;pre class="render" data-parents="pre-external-json"&gt;
                { "visibleLSB": 31 }&lt;/pre&gt;

            &lt;pre class="render" data-parents="pre-external-json"&gt;
                { "visibleMSB": 32 }&lt;/pre&gt;

            &lt;figcaption&gt;JSON outside the &lt;figure&gt;&lt;/figcaption&gt;

        &lt;/figure&gt;

        </pre>
    </section>
    <section id="sect-pcisig-style-table">
        <h2>PCISIG Style Table</h2>
        <p>

            If the &lt;figure&gt; element has the class <code>pcisig_reg</code> (in addition to the class
            <code>register</code>), and the
            <a>table</a> property is defined in the JSON the &lt;table&gt; element referenced by the
            <a>table</a> property is parsed and merged into the figure's JSON.
            The <a>table</a> property can either be specified directly in the JSON or via the
            <code>data-table</code> attribute on the &lt;figure&gt;.
        </p>
        <p>The underlying &lt;table&gt; can have any formatting. No specific <code>class</code> attribute is required.
        </p>
        <p>The first column contains the bit location of the field. This determines the <a>lsb</a> and
            <a>msb</a> properties of the field.
            The column cell contains either an integer or a pair of integers separated by a colon (e.g. &ldquo;9&rdquo;, &ldquo;15:8&rdquo; or &ldquo;8:15&rdquo;).
            If two numbers are shown, the MSB is usually first, but this is not required.</p>
        <p>
            The second column determines the <a>name</a> property of the field.
            It also contains a description of the field.
            The <a>name</a> property is derived from:</p>
        <ol>
            <li>
                The first word of the text content of the first <code>&lt;code&gt;</code> or
                <code>&lt;dfn&gt;</code> element.
            </li>
            <li>If no <code>&lt;code&gt;</code> or
                <code>&lt;dfn&gt;</code> element is present, the first word of the column cell.
            </li>
        </ol>
        <p>
            The third column determines the <a>attr</a> property of the field.
            This field is not case sensitive.
            Valid values are shown in the list below.
            If the third column does not on of the items, the <a>attr</a> property is &ldquo;other&rdquo;.</p>
        It the third column matches one of the items marked &ldquo;(unused)&rdquo;, the
        <a>isUnused</a> property is set to <code>true</code>, otherwise the <a>isUnused</a> property is not set.
        </p>
        <ul>
            <li>rw</li>
            <li>rws</li>
            <li>ro</li>
            <li>ros</li>
            <li>rw1c</li>
            <li>rw1cs</li>
            <li>rw1s</li>
            <li>rw1ss</li>
            <li>wo</li>
            <li>wos</li>
            <li>hardwired</li>
            <li>fixed</li>
            <li>hwinit</li>
            <li>rsvd (unused)</li>
            <li>rsvdp (unused)</li>
            <li>rsvdz (unused)</li>
            <li>reserved (unused)</li>
            <li>ignored (unused)</li>
            <li>ign (unused)</li>
            <li>unused (unused)</li>
            <li>other (default)</li>
        </ul>

        <p>
            <a href="fig-pcisig-example"></a> is shown in <a href="#example-pcisig-example"></a> and is based on <a
                href="#tbl-pcisig-example"></a>.
        </p>
        <figure class="register pcisig_reg" id="fig-pcisig-example" data-table="#tbl-pcisig-example">
            <figcaption>PCISIG Example</figcaption>
        </figure>
        <table id="tbl-pcisig-example">
            <caption>PCISIG Example</caption>
            <thead>
            <tr>
                <th>Bit Location</th>
                <th>Description</th>
                <th>Attr</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>3:0</td>
                <td><code>field3_0</code> this field is shown as <code>&lt;code&gt;field3_0&lt;/code&gt;</code>.</td>
                <td>RO</td>
            </tr>
            <tr>
                <td>4</td>
                <td><dfn>field_4</dfn> this field is shown as <code>&lt;dfn;&gt;field_4&lt;/dfn&gt;</code>.</td>
                <td>rw</td>
            </tr>
            <tr>
                <td>9</td>
                <td>This is the description.</td>
                <td>ros</td>
            </tr>
            <tr>
                <td>16:19</td>
                <td><dfn class="field">bits_16_19</dfn> this field is shown as
                    <code>&lt;dfn class="field"&gt;bits_16_19&lt;/dfn&gt;</code>.
                    Because the &lt;dfn&gt; has the class field, it is automatically linked to the corresponding field in the figure.
                    Similarly, that field in the figure is linked back to this definition.
                </td>
                Similarly, that field in the figure is linked back to this definition.</td>
                <td>rw</td>
            </tr>
            <tr>
                <td>24:31</td>
                <td>upper_bits</td>
                <td>hardwired</td>
            </tr>
            </tbody>
        </table>
    </section>
    <section id="sect-nvidia-refman">
        <h2>NVidia Refman</h2>
        <p>
            If the &lt;figure&gt; element has the class <code>nv_refman</code> (in addition to the class
            <code>register</code>), and the <a>href</a> property is defined in the JSON, the file referenced by the
            <a>href</a> property is read and the register defined by the <a>register</a> property is drawn as a figure.
            The <a>href</a> and <a>register</a> properties can either be specified directly in the JSON or via the
            <code>data-href</code> and <code>data-register</code> attributes.
            The referenced file MUST be formatted as an Nvidia refman file and MUST contain a register of the corresponding name.
        </p>
        <p>The <a>width</a> property is determined from the refman definition unless it is already specified in JSON.
        </p>
        <p>The attributes of each field are determined from the refman definition.
            These will be one of "ro", "rw", or "wo".</p>
    </section>
</section>

</body>

</html>
